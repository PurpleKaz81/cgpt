# v0.2.20 Split-Audit (Planned)

Last updated: 2026-02-19

## Status

- Status: `planned`
- Target release: `v0.2.20`
- Roadmap ID: `R17`

## Problem

When users generate split dossiers (`raw.txt` + `__working.txt`), verifying that important content was not over-removed is currently manual and too expensive at scale.

## Goal

Ship a fast, built-in verification step that flags suspicious removals between raw and working TXT outputs in seconds, not hours.

## Proposed CLI Surface (Phase 1)

Add a new command:

```bash
cgpt split-audit <raw_txt_path> [--working <working_txt_path>] [--strict] [--json]
```

Behavior:

- If `--working` is omitted, infer `<raw_stem>__working.txt`.
- Compare raw vs working as text.
- Write a human-readable report file next to the working file:
  - `<raw_stem>__split_audit.txt`
- Optionally print machine-readable JSON to stdout when `--json` is passed.
- Print a one-line summary with `PASS` or `WARN`.

## Suspicion Model

The audit should classify removed lines into:

- Benign removals:
  - tool-call metadata
  - citation markers
  - known cleanup artifacts
- Suspicious removals:
  - URLs
  - JSON-like structures (`{}`, `[]`, key/value patterns)
  - code fences or inline code markers
  - lines with decision/deliverable keywords (`decision`, `constraint`, `draft`, `output`, `result`)

## Exit Semantics

- Default mode:
  - exit `0` for both `PASS` and `WARN`
  - `WARN` means suspicious removals were detected and review is recommended
- Strict mode (`--strict`):
  - exit `2` on `WARN`
  - exit `0` on `PASS`
- Fatal input/IO errors:
  - exit `1`

## Report Contract

Minimum report sections:

1. File metadata (raw path, working path, byte sizes)
2. Diff summary (added/removed/changed counts)
3. Suspicious removal count
4. Sample suspicious lines (capped)
5. Recommendation (`safe to proceed` or `manual review required`)

## Performance Target

- Target runtime: under 2 seconds for typical dossier sizes used in local workflows.
- Must not load external services or require network access.

## Acceptance Criteria

- A user can run one command and quickly know whether split cleaning likely removed important content.
- The command works on existing dossier files generated in prior runs.
- The report is deterministic for the same pair of files.
- Unit coverage includes:
  - inferred `__working.txt` path behavior
  - suspicious-line detection
  - strict-mode exit behavior
  - missing file / invalid path failures

## Non-Goals (Phase 1)

- No semantic/LLM-based judgment.
- No automatic restoration of removed lines.
- No changes to existing `--split` cleaning pipeline behavior yet.
